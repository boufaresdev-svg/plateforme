<!-- Controls Section -->
<div class="controls-section">
  <div class="search-box">
    <input 
      type="text" 
      placeholder="üîç Rechercher un fournisseur..." 
      [value]="searchTerm"
      (input)="onSearchTermChange($any($event.target).value)"
      class="search-input">
  </div>
  
  <div class="action-buttons-header">
    <button class="btn-primary" (click)="showAddFournisseurForm()">
      ‚ûï Nouveau Fournisseur
    </button>
  </div>
</div>

<!-- Table Container -->
<div class="table-container">
  <!-- Empty State -->
  <div *ngIf="filteredFournisseurs.length === 0" class="empty-state">
    <div class="empty-icon">üìã</div>
    <h4>Aucun fournisseur trouv√©</h4>
    <p>Essayez de modifier vos crit√®res de recherche ou ajoutez un nouveau fournisseur.</p>
  </div>

  <!-- Fournisseurs Table -->
  <table class="modern-table" *ngIf="filteredFournisseurs.length > 0">
    <thead>
      <tr>
        <th class="sortable" 
            [class.sorted]="pagination.sortBy === 'nom'"
            (click)="onSort('nom')">
          Nom 
          <span class="sort-indicator" *ngIf="pagination.sortBy === 'nom'">
            {{ pagination.sortDirection === 'ASC' ? '‚ñ≤' : '‚ñº' }}
          </span>
        </th>
        <th>Contact</th>
        <th>Adresse</th>
        <th>T√©l√©phone</th>
        <th class="sortable"
            [class.sorted]="pagination.sortBy === 'matriculeFiscale'"
            (click)="onSort('matriculeFiscale')">
          Matricule Fiscal
          <span class="sort-indicator" *ngIf="pagination.sortBy === 'matriculeFiscale'">
            {{ pagination.sortDirection === 'ASC' ? '‚ñ≤' : '‚ñº' }}
          </span>
        </th>
        <th>Solde Total</th>
        <th>Montant √† Payer</th>
        <th>Statut</th>
        <th class="actions-col">Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let fournisseur of filteredFournisseurs">
        <td class="name-cell">
          <strong>{{ fournisseur.nom }}</strong>
        </td>
        <td>{{ fournisseur.infoContact }}</td>
        <td>{{ fournisseur.adresse }}</td>
        <td>{{ fournisseur.telephone }}</td>
        <td>{{ fournisseur.matriculeFiscale }}</td>
        <td class="amount-cell" [style.color]="(fournisseur.soldeTotal ?? 0) > 0 ? '#f57c00' : '#666'">
          <strong>{{ (fournisseur.soldeTotal ?? 0) | number:'1.2-2' }} DT</strong>
        </td>
        <td class="amount-cell" [style.color]="(fournisseur.montantAPayer ?? 0) > 0 ? '#d32f2f' : '#2e7d32'">
          <strong>{{ (fournisseur.montantAPayer ?? 0) | number:'1.2-2' }} DT</strong>
        </td>
        <td>
          <span class="payment-status-badge" 
                [class.status-paid]="(fournisseur.montantAPayer ?? 0) === 0 && (fournisseur.soldeTotal ?? 0) > 0"
                [class.status-outstanding]="(fournisseur.montantAPayer ?? 0) > 0"
                [class.status-none]="(fournisseur.soldeTotal ?? 0) === 0">
            <span *ngIf="(fournisseur.montantAPayer ?? 0) === 0 && (fournisseur.soldeTotal ?? 0) > 0">‚úì Pay√©</span>
            <span *ngIf="(fournisseur.montantAPayer ?? 0) > 0">‚ö† En cours</span>
            <span *ngIf="(fournisseur.soldeTotal ?? 0) === 0">- Aucune dette</span>
          </span>
        </td>
        <td class="actions-cell">
          <div class="action-buttons">
            <button class="btn-action btn-view" (click)="viewFournisseurDetails(fournisseur)" title="Voir d√©tails">
              üëÅÔ∏è
            </button>
            <button class="btn-action btn-edit" (click)="editFournisseur(fournisseur)" title="Modifier">
              ‚úèÔ∏è
            </button>
            <button class="btn-action btn-delete" (click)="deleteFournisseur(fournisseur)" title="Supprimer">
              üóëÔ∏è
            </button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Pagination Controls -->
<div class="pagination-wrapper">
  <!-- Loading indicator -->
  <div class="loading-overlay" *ngIf="pagination.isLoading">
    <div class="spinner">‚è≥ Chargement...</div>
  </div>

  <div class="pagination-footer">
    <div class="pagination-info">
      <span>
        Affichage de {{ (pagination.currentPage * pagination.pageSize) + 1 }} 
        √† {{ Math.min((pagination.currentPage + 1) * pagination.pageSize, pagination.totalElements) }} 
        sur {{ pagination.totalElements }} fournisseurs
      </span>
    </div>

    <div class="pagination-numbers">
      <button 
        class="page-nav-btn"
        [disabled]="pagination.currentPage === 0 || pagination.isLoading"
        (click)="onPageChange(pagination.currentPage - 1)"
        title="Page pr√©c√©dente">
        ‚Äπ
      </button>

      <button 
        *ngFor="let page of getPaginationPages()"
        class="page-number-btn"
        [class.active]="page === pagination.currentPage"
        [disabled]="pagination.isLoading"
        (click)="onPageChange(page)">
        {{ page + 1 }}
      </button>

      <button 
        class="page-nav-btn"
        [disabled]="pagination.currentPage >= pagination.totalPages - 1 || pagination.isLoading"
        (click)="onPageChange(pagination.currentPage + 1)"
        title="Page suivante">
        ‚Ä∫
      </button>
    </div>

    <div class="page-size-control">
      <select 
        [value]="pagination.pageSize"
        (change)="onPageSizeChange($any($event.target).value)"
        [disabled]="pagination.isLoading">
        <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }} par page</option>
      </select>
    </div>
  </div>
</div>

<!-- Modal Formulaire Fournisseur -->
<div class="popup-overlay" *ngIf="showForm" (click)="cancelForm()">
  <div class="popup-container" (click)="$event.stopPropagation()">
    <div class="popup-header">
      <h2>{{ isEditMode ? 'Modifier' : 'Nouveau' }} Fournisseur</h2>
      <button class="popup-close" (click)="cancelForm()">‚úï</button>
    </div>

    <form [formGroup]="fournisseurForm" class="popup-form" (ngSubmit)="saveFournisseur()">
      <div class="form-section">
        <h3>Informations du fournisseur</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Nom *</label>
            <input 
              type="text" 
              class="form-input" 
              formControlName="nom" 
              placeholder="Nom du fournisseur"
              [class.error]="hasError('nom', 'required') || hasError('nom', 'minlength')">
            <div class="error-message" *ngIf="hasError('nom', 'required')">
              Le nom est obligatoire
            </div>
            <div class="error-message" *ngIf="hasError('nom', 'minlength')">
              Le nom doit contenir au moins 2 caract√®res
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Email *</label>
            <input 
              type="email" 
              class="form-input" 
              formControlName="infoContact" 
              placeholder="email@exemple.com"
              [class.error]="hasError('infoContact', 'required') || hasError('infoContact', 'email')">
            <div class="error-message" *ngIf="hasError('infoContact', 'required')">
              L'email est obligatoire
            </div>
            <div class="error-message" *ngIf="hasError('infoContact', 'email')">
              L'email doit √™tre valide
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">T√©l√©phone *</label>
            <input 
              type="tel" 
              class="form-input" 
              formControlName="telephone" 
              placeholder="Num√©ro de t√©l√©phone"
              [class.error]="hasError('telephone', 'required')">
            <div class="error-message" *ngIf="hasError('telephone', 'required')">
              Le t√©l√©phone est obligatoire
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Matricule Fiscal *</label>
            <input 
              type="text" 
              class="form-input" 
              formControlName="matriculeFiscale" 
              placeholder="Matricule fiscal"
              [class.error]="hasError('matriculeFiscale', 'required')">
            <div class="error-message" *ngIf="hasError('matriculeFiscale', 'required')">
              Le matricule fiscal est obligatoire
            </div>
          </div>

          <div class="form-group full-width">
            <label class="form-label">Adresse *</label>
            <input 
              type="text" 
              class="form-input" 
              formControlName="adresse" 
              placeholder="Adresse compl√®te"
              [class.error]="hasError('adresse', 'required')">
            <div class="error-message" *ngIf="hasError('adresse', 'required')">
              L'adresse est obligatoire
            </div>
          </div>
        </div>
      </div>

      <div class="popup-actions">
        <button type="button" class="btn-outline" (click)="cancelForm()">Annuler</button>
        <button type="submit" class="btn-primary" [disabled]="fournisseurForm.invalid && submitted">
          {{ isEditMode ? 'Modifier' : 'Cr√©er' }}
        </button>
      </div>
    </form>
  </div>
</div>