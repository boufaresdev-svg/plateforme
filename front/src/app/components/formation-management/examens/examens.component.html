<div class="examens-view">
  <div class="examens-container">
    <!-- TABS -->
    <div class="tabs-header">
      <button
        class="tab-btn"
        [class.active]="currentTab === 'examens'"
        (click)="currentTab = 'examens'"
      >
        üìù Examens
      </button>
      <button
        class="tab-btn"
        [class.active]="currentTab === 'certificats'"
        (click)="currentTab = 'certificats'"
      >
        üèÜ Certificats
      </button>
    </div>

    <!-- CONTENT -->
    <div class="tab-content">
      <div class="table-header">
        <h2>
          <span *ngIf="currentTab === 'examens'">üìù Examens</span>
          <span *ngIf="currentTab === 'certificats'">üèÜ Certificats</span>
        </h2>
        <div class="header-actions">
          <div class="search-bar">
            <div class="search-field wide">
              <span class="search-icon">üîç</span>
              <input
                type="text"
                [(ngModel)]="searchTerm"
                placeholder="Rechercher par titre, description..."
                class="form-input"
              />
            </div>
            <button
              class="btn-secondary subtle"
              type="button"
              (click)="searchTerm = ''"
            >
              R√©initialiser
            </button>
          </div>

          <button class="btn-primary" (click)="openModal(currentTab.slice(0, -1))">
            ‚ûï Nouveau
          </button>
        </div>
      </div>

      <!-- EXAMENS TABLE -->
      <ng-container *ngIf="currentTab === 'examens'">
        <div class="modern-table" *ngIf="filteredItems().length; else noExamens">
          <div class="table-row header">
            <div>Type</div>
            <div>Date</div>
            <div>Description</div>
            <div>Score</div>
            <div>Plan</div>
            <div>Apprenant</div>
            <div>Actions</div>
          </div>

          <ng-container *ngFor="let examen of filteredItems()">
            <div class="table-row">
              <div>{{ examen.type }}</div>
              <div>{{ examen.date | date:'dd/MM/yyyy' }}</div>
              <div>{{ examen.description || '‚Äî' }}</div>
              <div>{{ examen.score || '‚Äî' }}</div>
              <div>{{ examen.planFormation?.titre || '‚Äî' }}</div>
              <div>{{ examen.apprenant?.prenom }} {{ examen.apprenant?.nom }}</div>
              <div class="actions">
                <button class="action-btn" (click)="editExamen(examen)">‚úèÔ∏è</button>
                <button class="action-btn" (click)="viewCertificatsForExamen(examen)">üèÜ</button>
                <button class="action-btn danger" (click)="deleteExamen(examen.idExamen!)">üóëÔ∏è</button>
              </div>
            </div>
          </ng-container>
        </div>

        <ng-template #noExamens>
          <p class="no-data">Aucun examen √† afficher</p>
        </ng-template>
      </ng-container>

      <!-- CERTIFICATS TABLE -->
      <ng-container *ngIf="currentTab === 'certificats'">
        <div class="modern-table" *ngIf="filteredItems().length; else noCertificats">
          <div class="table-row header">
            <div>Titre</div>
            <div>Description</div>
            <div>Niveau</div>
            <div>Examen</div>
            <div>Apprenant</div>
            <div>Actions</div>
          </div>

          <ng-container *ngFor="let certificat of filteredItems()">
            <div class="table-row">
              <div>{{ certificat.titre }}</div>
              <div>{{ certificat.description || '‚Äî' }}</div>
              <div>{{ certificat.niveau || '‚Äî' }}</div>
              <div>{{ certificat.examen?.type || '‚Äî' }}</div>
              <div>{{ certificat.apprenant?.prenom }} {{ certificat.apprenant?.nom }}</div>
              <div class="actions">
                <button class="action-btn" (click)="editCertificat(certificat)">‚úèÔ∏è</button>
                <button class="action-btn danger" (click)="deleteCertificat(certificat.idCertificat!)">üóëÔ∏è</button>
              </div>
            </div>
          </ng-container>
        </div>

        <ng-template #noCertificats>
          <p class="no-data">Aucun certificat √† afficher</p>
        </ng-template>
      </ng-container>
    </div>
  </div>

  <!-- MODAL -->
  <div class="modal" *ngIf="showModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>{{ modalTitle }}</h2>
        <button class="btn-close" (click)="closeModal()">‚úï</button>
      </div>

      <div class="modal-body">
        <!-- Examen Form -->
        <ng-container *ngIf="modalType === 'examen'">
          <div class="form-group">
            <label>Type</label>
            <input
              type="text"
              [(ngModel)]="examenFormData.type"
              class="form-input"
              placeholder="Type d'examen"
            />
          </div>

          <div class="form-group">
            <label>Date</label>
            <input
              type="date"
              [(ngModel)]="examenFormData.date"
              class="form-input"
            />
          </div>

          <div class="form-group">
            <label>Description</label>
            <textarea
              [(ngModel)]="examenFormData.description"
              class="form-input"
              placeholder="Description"
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Score</label>
              <input
                type="number"
                [(ngModel)]="examenFormData.score"
                class="form-input"
              />
            </div>

            <div class="form-group">
              <label>Plan Formation</label>
              <select [(ngModel)]="examenFormData.idPlanFormation" class="form-input">
                <option [value]="null">-- S√©lectionner --</option>
                <option *ngFor="let p of plansFormation" [value]="p.idPlanFormation">
                  {{ p.titre }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <label>Apprenant</label>
              <select [(ngModel)]="examenFormData.idApprenant" class="form-input">
                <option [value]="null">-- S√©lectionner --</option>
                <option *ngFor="let a of apprenants" [value]="a.idApprenant">
                  {{ a.prenom }} {{ a.nom }}
                </option>
              </select>
            </div>
          </div>
        </ng-container>

        <!-- Certificat Form -->
        <ng-container *ngIf="modalType === 'certificat'">
          <div class="form-group">
            <label>Titre</label>
            <input
              type="text"
              [(ngModel)]="certificatFormData.titre"
              class="form-input"
              placeholder="Titre du certificat"
            />
          </div>

          <div class="form-group">
            <label>Description</label>
            <textarea
              [(ngModel)]="certificatFormData.description"
              class="form-input"
              placeholder="Description"
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Niveau</label>
              <input
                type="text"
                [(ngModel)]="certificatFormData.niveau"
                class="form-input"
                placeholder="Niveau"
              />
            </div>

            <div class="form-group">
              <label>Examen</label>
              <select [(ngModel)]="certificatFormData.idExamen" class="form-input">
                <option [value]="null">-- S√©lectionner --</option>
                <option *ngFor="let e of examens" [value]="e.idExamen">
                  {{ e.type }} - {{ e.date | date:'dd/MM/yyyy' }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <label>Apprenant</label>
              <select [(ngModel)]="certificatFormData.idApprenant" class="form-input">
                <option [value]="null">-- S√©lectionner --</option>
                <option *ngFor="let a of apprenants" [value]="a.idApprenant">
                  {{ a.prenom }} {{ a.nom }}
                </option>
              </select>
            </div>
          </div>
        </ng-container>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeModal()">Annuler</button>
        <button
          class="btn-primary"
          (click)="modalType === 'examen' ? saveExamen() : saveCertificat()"
        >
          Enregistrer
        </button>
      </div>
    </div>
  </div>
</div>
