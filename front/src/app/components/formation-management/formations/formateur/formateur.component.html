<div class="content-section">
  <div class="objective-header">
    <h2 class="objective-title">üìÑ {{ editingPlanId ? 'Modifier' : 'G√©n√©rer' }} Plan de Formation</h2>
    <button class="btn-close" type="button" (click)="onClose()">‚úï</button>
  </div>

  <div class="plan-generator-form">
    <div class="info-box">
      <p><strong>‚ÑπÔ∏è Informations</strong></p>
      <p>Compl√©tez les informations ci-dessous pour g√©n√©rer un plan de formation professionnel au format PDF.</p>
    </div>

    <div class="field">
      <label>Titre du Plan *</label>
      <input class="input" type="text" [(ngModel)]="planGeneratorForm.titre" name="planTitre" placeholder="Ex: Plan de formation Angular Avanc√© 2025" required />
    </div>

    <div class="field">
      <label>Description</label>
      <textarea class="textarea" rows="3" [(ngModel)]="planGeneratorForm.description" name="planDescription" placeholder="D√©crivez le contexte du plan de formation..."></textarea>
    </div>

    <div class="grid mini">
      <div class="field">
        <label>Date de d√©but</label>
        <input class="input" type="date" [(ngModel)]="planGeneratorForm.dateDebut" name="planDateDebut" />
      </div>
      <div class="field">
        <label>Date de fin</label>
        <input class="input" type="date" [(ngModel)]="planGeneratorForm.dateFin" name="planDateFin" />
      </div>
    </div>

    <div class="field">
      <label>Formateur / Responsable</label>
      <select class="input" [(ngModel)]="planGeneratorForm.formateurId" name="planFormateur">
        <option [value]="undefined">-- S√©lectionner un formateur --</option>
        <option *ngFor="let f of formateurs" [value]="f.idFormateur">{{ f.nom }} {{ f.prenom }}</option>
      </select>
    </div>

    <div class="grid mini">
      <div class="field">
        <label>Date de lancement</label>
        <input class="input" type="date" [(ngModel)]="planGeneratorForm.dateLancement" name="planDateLancement" />
      </div>
      <div class="field">
        <label>Date de fin r√©el</label>
        <input class="input" type="date" [(ngModel)]="planGeneratorForm.dateFinReel" name="planDateFinReel" />
      </div>
    </div>

    <div class="field">
      <label>Nombre de jours</label>
      <input class="input" [class.error]="hasDaysMismatch" type="number" min="0" [(ngModel)]="planGeneratorForm.nombreJours" name="planNombreJours" placeholder="Ex: 5" />
      <small class="calculated-days">
        <span *ngIf="calculatedDays > 0">üìÖ Dur√©e selon dates: <strong>{{ calculatedDays }} jours</strong></span>
        <span *ngIf="calculatedDays > 0 && contentDaysCount > 0"> | </span>
        <span *ngIf="contentDaysCount > 0">üìö Jours avec contenu: <strong>{{ contentDaysCount }} jours</strong></span>
      </small>
      <div class="warning-message" *ngIf="hasDaysMismatch">
        ‚ö†Ô∏è Attention: Le nombre de jours saisi ({{ planGeneratorForm.nombreJours }}) est inf√©rieur au nombre requis ({{ requiredDays }} jours). V√©rifiez les dates ou le nombre de jours.
      </div>
      <div class="warning-message" *ngIf="hasDateRangeMismatch && !hasDaysMismatch">
        ‚ö†Ô∏è Attention: La plage de dates ({{ calculatedDays }} jours) est insuffisante pour les {{ contentDaysCount }} jours de contenu planifi√©s.
      </div>
    </div>

    <div class="field">
      <label>Statut</label>
      <select class="input" [(ngModel)]="planGeneratorForm.status" name="planStatus">
        <option value="PLANIFIEE">Planifi√©e</option>
        <option value="EN_COURS">En cours</option>
        <option value="TERMINEE">Termin√©e</option>
        <option value="ANNULEE">Annul√©e</option>
        <option value="REPORTEE">Report√©e</option>
      </select>
    </div>

    <div class="summary-box">
      <h3>üìä R√©sum√© de la formation</h3>
      <div class="summary-grid">
        <div class="summary-item">
          <span class="summary-label">Th√®me:</span>
          <span class="summary-value">{{ form.theme || '‚Äî' }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Type:</span>
          <span class="summary-value">{{ form.typeFormation || '‚Äî' }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Niveau:</span>
          <span class="summary-value">{{ form.niveau || '‚Äî' }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Dur√©e totale:</span>
          <span class="summary-value">{{ totalHoursOverall() }}h</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Objectifs globaux:</span>
          <span class="summary-value">{{ getSelectedCount(objectifsGlobauxExemples) }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Objectifs sp√©cifiques:</span>
          <span class="summary-value">{{ getSelectedCount(objectifsSpecifiquesExemples) }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Contenus:</span>
          <span class="summary-value">{{ contentItems.length }} activit√©s</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Jours de formation:</span>
          <span class="summary-value">{{ contentDays.length }} jours</span>
        </div>
      </div>
    </div>

    <div class="actions" style="margin-top: 20px;">
      <button type="button" class="btn primary" (click)="onGeneratePdf()">
        üì• G√©n√©rer le PDF
      </button>
      <button type="button" class="btn primary" (click)="onSavePlan()" [disabled]="saving">
        üíæ {{ saving ? 'Enregistrement...' : (editingPlanId ? 'Modifier' : 'Enregistrer') }}
      </button>
      <button type="button" class="btn" (click)="onClose()">
        Annuler
      </button>
    </div>
  </div>
</div>
